'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _documentStore = require('@sanity/document-store');

var _documentStore2 = _interopRequireDefault(_documentStore);

var _client = require('part:@sanity/base/client');

var _client2 = _interopRequireDefault(_client);

var _rxjs = require('rxjs');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var serverConnection = {
  byId: function byId(id) {
    return _rxjs.Observable.timer(0, 5000).flatMap(function () {
      return _client2.default.getDocument(id);
    })
    // .do(response => console.log('response', response))
    .map(function (doc) {
      return {
        type: 'snapshot',
        document: doc
      };
    });
  },
  query: function query(_query, params) {
    return _rxjs.Observable.timer(0, 50000).flatMap(function () {
      return _client2.default.fetch(_query, params);
    }).map(function (documents) {
      return {
        type: 'snapshot',
        documents: documents
      };
    });
  },
  update: function update(id, patch) {
    return _rxjs.Observable.from(_client2.default.patch(id, patch).commit());
  },
  create: function create(doc) {
    return _rxjs.Observable.from(_client2.default.create(doc));
  }
};

exports.default = (0, _documentStore2.default)({ serverConnection: serverConnection });